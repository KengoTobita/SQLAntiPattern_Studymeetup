---
marp: true
theme: default
size: 16:9
paginate: true
headingDivider: 2
backgroundImage: url('https://marp.app/assets/hero-background.svg')
---

# SQLアンチパターン <br> 第II部：物理設計のアンチパターン

<!-- --- -->

## 第9章：ラウンディングエラー（丸め誤差）

### 🎯 目的
整数の代わりに小数値を使用する

#### ⚠️ アンチパターン
`FLOAT`型の使用（誤差が発生）

- 丸め誤差による計算ミス
- 精度が必要な場合に致命的

#### ✅ 解決策
`NUMERIC`型（精度指定あり）を使う  
→ 金額・座標・統計値などに適切
<!-- --- -->

## 第10章：サーティワンフレーバー

### 🎯 目的
列を特定の値に限定する

### ⚠️ アンチパターン
`CHECK`制約などで列にハードコード

- 値の追加が難しい
- ポータビリティの低下

### ✅ 解決策
値を参照テーブルで管理  
→ メタデータ的に拡張できる仕組みに

<!-- --- -->

## 第11章：ファントムファイル

### 🎯 目的
画像や大容量メディアファイルを格納

### ⚠️ アンチパターン
物理ファイルのみで管理（DB外）

- 削除やロールバックとの整合性問題
- アクセス権管理が分離

### ✅ 解決策
必要に応じて`BLOB`型で格納  
→ DB内での整合性確保がしやすくなる

<!-- --- -->

## 第12章：インデックスショットガン

### 🎯 目的
パフォーマンス最適化

### ⚠️ アンチパターン
無計画なインデックス追加

- 読み書き性能の悪化
- クエリ最適化の混乱

<!-- --- -->

## ✅ 12章解決策
「**MENTOR原則**」に基づく運用

- **M**easure（測定）
- **E**xplain（解析）
- **N**ominate（候補選定）
- **T**est（テスト）
- **O**ptimize（最適化）
- **R**ebuild（再構築）

<!-- --- -->

## 🧪 ハンズオンのヒント

- `FLOAT` vs `NUMERIC` で金額計算の差異を実験
- `CHECK` vs 参照テーブルでバリデーション設計比較
- ファイルパス vs BLOB の更新・削除時の挙動確認
- インデックスの有無によるクエリ実行時間の差

<!-- --- -->

## 🚀 次回予告

次章では**第III部：クエリのアンチパターン**に突入します！

